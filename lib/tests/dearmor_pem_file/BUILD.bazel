"Tests for dearmor_gpg_file"

load("//lib:dearmor_pem_file.bzl", "dearmor_pem_file")
load("//lib:testing.bzl", "assert_contains")

dearmor_pem_file(
    name = "debian_bookworm_key",
    key = ":test_public_key.gpg",
)

genrule(
    name = "keystrings",
    outs = ["keystrings.txt"],
    cmd = "cat $(location :debian_bookworm_key) | strings > $@",
    toolchains = ["@coreutils_toolchains//:resolved_toolchain"],
    srcs = [":debian_bookworm_key"],
)

assert_contains(
    name = "debian_bookworm_key_binary",
    actual = ":keystrings.txt",
    expected = "Debian Stable Release Key",
)
